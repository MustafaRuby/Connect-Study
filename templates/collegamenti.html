<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Collegamenti{% if materia_selezionata %} - {{ materia_selezionata.nome }}{% endif %} - ConnectStudy</title>
    
    <!-- Modular CSS imports -->
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/animations.css">    <link rel="stylesheet" href="/static/css/buttons.css">
    <link rel="stylesheet" href="/static/css/cards.css">
    <link rel="stylesheet" href="/static/css/modals.css">
    <link rel="stylesheet" href="/static/css/forms.css">
    <link rel="stylesheet" href="/static/css/search.css">    <link rel="stylesheet" href="/static/css/context-menu.css">
    <link rel="stylesheet" href="/static/css/responsive.css">
    <link rel="stylesheet" href="/static/css/collegamenti-page.css">
    <link rel="stylesheet" href="/static/css/collegamenti-page-responsive.css">
    <link rel="stylesheet" href="/static/css/button-icons.css">
    
    <!-- Local libraries CSS -->
    <link rel="stylesheet" href="/static/libs/highlightjs/vs2015.min.css">
    
    <!-- Local libraries JavaScript -->
    <script src="/static/libs/socketio/socket.io.min.js"></script>
    <script src="/static/libs/marked/marked.min.js"></script>
      <!-- Highlight.js for code syntax highlighting -->
    <script src="/static/libs/highlightjs/highlight.min.js"></script>
    <script src="/static/libs/highlightjs/python.min.js"></script>
    <script src="/static/libs/highlightjs/sql.min.js"></script>
    <script src="/static/libs/highlightjs/json.min.js"></script>
    <script src="/static/libs/highlightjs/xml.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="page-title">
                        <span class="icon">üîó</span>
                        Collegamenti
                        {% if materia_selezionata %}
                            <span class="subtitle" style="color: {{ materia_selezionata.colore }}">{{ materia_selezionata.nome }}</span>
                        {% endif %}
                    </h1>
                </div>
                <div class="header-right">
                    <button class="btn btn-primary" onclick="showCollegamentoModal()">
                        <span class="icon">‚ûï</span>
                        Nuovo Collegamento
                    </button>
                    <a href="/" class="btn btn-secondary">
                        <span class="icon">üè†</span>
                        Home
                    </a>
                </div>
            </div>        </header>        <!-- Search and filters -->
        <div class="search-filters-section">
            <div class="search-container">
                <div class="search-group">
                    <label for="search-titolo">Cerca per titolo:</label>
                    <input type="text" id="search-titolo" placeholder="Cerca collegamenti per titolo..." class="search-input">
                </div>
                <div class="search-group">
                    <label for="search-dettagli">Cerca nei dettagli:</label>
                    <input type="text" id="search-dettagli" placeholder="Cerca nei dettagli dei collegamenti..." class="search-input">
                </div>
                <div class="search-group">
                    <label for="search-argomenti">Cerca negli argomenti:</label>
                    <input type="text" id="search-argomenti" placeholder="Cerca tra gli argomenti coinvolti..." class="search-input">
                </div>
                <div class="search-group">
                    <label for="filter-qualita">Filtra per qualit√†:</label>
                    <select id="filter-qualita" class="filter-select">
                        <option value="">Tutte le qualit√†</option>
                        <option value="collegamento forzato">Forzato</option>
                        <option value="collegamento media qualit√†">Media qualit√†</option>
                        <option value="collegamento buona qualit√†">Buona qualit√†</option>
                        <option value="collegamento alta qualit√†">Alta qualit√†</option>
                    </select>
                </div>
                {% if not materia_selezionata %}
                <div class="search-group">
                    <label for="filter-materia">Filtra per materia:</label>
                    <select id="filter-materia" class="filter-select">
                        <option value="">Tutte le materie</option>
                        {% for materia in materie %}
                        <option value="{{ materia.nome }}">{{ materia.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}
                <button id="clear-filters" class="clear-btn">
                    <span class="icon">üóëÔ∏è</span>
                    Pulisci filtri
                </button>
            </div>
        </div><!-- Navigation breadcrumb -->
        <nav class="breadcrumb">
            <a href="/">Home</a>
            {% if materia_selezionata %}
                <span class="separator">‚Ä∫</span>
                <a href="/materia/{{ materia_selezionata.id }}">{{ materia_selezionata.nome }}</a>
                <span class="separator">‚Ä∫</span>
                <span class="current">Collegamenti</span>
            {% else %}
                <span class="separator">‚Ä∫</span>
                <span class="current">Tutti i Collegamenti</span>
            {% endif %}
        </nav>

        <!-- Collegamenti grid -->
        <div class="content">
            <div id="collegamenti-grid" class="collegamenti-grid">
                {% for collegamento in collegamenti %}
                <div class="collegamento-card" data-id="{{ collegamento.id }}">
                    <div class="collegamento-header">
                        <h3 class="collegamento-title">{{ collegamento.titolo }}</h3>
                        <div class="collegamento-actions">
                            <button class="btn-icon" onclick="editCollegamento({{ collegamento.id }})" title="Modifica">
                                <img src="/static/icons/modify-icon.svg" alt="Modifica">
                            </button>
                            <button class="btn-icon btn-danger" onclick="deleteCollegamento({{ collegamento.id }})" title="Elimina">
                                <img src="/static/icons/delete-icon.svg" alt="Elimina">
                            </button>
                        </div>
                    </div>
                    
                    <div class="collegamento-argomenti">
                        <div class="argomento-tag" style="border: 2.5px solid {{ collegamento.materia1_colore }};">
                            <a href="/argomento/{{ collegamento.id_argomento1 }}">
                                {{ collegamento.argomento1_titolo }}
                            </a>
                            <span class="materia-name">{{ collegamento.materia1_nome }}</span>
                        </div>
                        <div class="collegamento-arrow">‚ü∑</div>
                        <div class="argomento-tag" style="border: 2.5px solid {{ collegamento.materia2_colore }};">
                            <a href="/argomento/{{ collegamento.id_argomento2 }}">
                                {{ collegamento.argomento2_titolo }}
                            </a>
                            <span class="materia-name">{{ collegamento.materia2_nome }}</span>
                        </div>
                    </div>

                    {% if collegamento.dettagli %}
                    <div class="collegamento-dettagli">
                        <button class="dettagli-toggle" onclick="toggleDettagli({{ collegamento.id }})">
                            <span class="icon">üîé</span> Visualizza dettagli
                        </button>
                    </div>
                    {% endif %}                    <div class="collegamento-footer">
                        <span class="etichetta-qualita {{ collegamento.etichetta_qualita.replace(' ', '-') }}">
                            {{ collegamento.etichetta_qualita|title }}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>

            {% if not collegamenti %}
            <div class="empty-state">
                <div class="empty-icon">üîó</div>
                <h3>Nessun collegamento trovato</h3>
                <p>{% if materia_selezionata %}
                    Non ci sono ancora collegamenti per la materia "{{ materia_selezionata.nome }}".
                   {% else %}
                    Non hai ancora creato nessun collegamento.
                   {% endif %}
                </p>
                <button class="btn btn-primary" onclick="showCollegamentoModal()">
                    Crea il primo collegamento
                </button>
            </div>
            {% endif %}
        </div>
    </div>    <!-- Modal per i dettagli del collegamento -->
    <div id="dettagli-modal" class="modal" style="display: none;">
        <div class="modal-content">            <div class="modal-header">
                <h3>Dettagli Collegamento</h3>
                <button class="modal-close" onclick="closeDettagliModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="dettagli-content" class="markdown-content"></div>
                <div class="modal-buttons" style="margin-top: 20px;">
                    <button type="button" class="cancel-btn" onclick="closeDettagliModal()">Chiudi</button>
                </div>
            </div>
        </div>
    </div>    <!-- Modal per creare/modificare collegamento -->
    <div id="collegamento-modal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="modal-title">Nuovo Collegamento</h3>
                <button class="modal-close" onclick="closeCollegamentoModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="collegamento-form">
                    <input type="hidden" id="collegamento-id" value="">
                    <div class="form-group">
                        <label for="titolo">Titolo del collegamento:</label>
                        <input type="text" id="titolo" name="titolo" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Primo argomento:</label>
                            <div class="argomento-selector">
                                <div id="argomento1-selected" class="argomento-selected">
                                    <span class="placeholder">Seleziona argomento</span>
                                    <button type="button" class="cancel-btn" onclick="clearArgomento(1)">‚úï</button>
                                </div>
                                <button type="button" class="add-btn" onclick="selectArgomento(1)">
                                    Scegli Argomento
                                </button>
                                <input type="hidden" id="id_argomento1" name="id_argomento1">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Secondo argomento:</label>
                            <div class="argomento-selector">
                                <div id="argomento2-selected" class="argomento-selected">
                                    <span class="placeholder">Seleziona argomento</span>
                                    <button type="button" class="cancel-btn" onclick="clearArgomento(2)">‚úï</button>
                                </div>
                                <button type="button" class="add-btn" onclick="selectArgomento(2)">
                                    Scegli Argomento
                                </button>
                                <input type="hidden" id="id_argomento2" name="id_argomento2">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="etichetta_qualita">Qualit√† del collegamento:</label>
                        <select id="etichetta_qualita" name="etichetta_qualita">
                            <option value="collegamento forzato">Collegamento forzato</option>
                            <option value="collegamento media qualit√†" selected>Collegamento media qualit√†</option>
                            <option value="collegamento buona qualit√†">Collegamento buona qualit√†</option>
                            <option value="collegamento alta qualit√†">Collegamento alta qualit√†</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dettagli">Dettagli del collegamento:</label>
                        <textarea id="dettagli" name="dettagli" rows="6" 
                                placeholder="Spiega come questi argomenti sono collegati..."></textarea>
                    </div>
                    <div class="popup-actions">
                        <button type="submit" class="add-btn">
                            Salva Collegamento
                        </button>
                        <button type="button" class="cancel-btn" onclick="closeCollegamentoModal()">
                            Annulla
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>    <!-- Modal per selezionare argomento -->
    <div id="argomento-selector-modal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Seleziona Argomento</h3>
                <button class="modal-close" onclick="closeArgomentoSelectorModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="argomento-search">
                    <input type="text" id="argomento-search" placeholder="Cerca argomenti..." class="search-input">
                </div>
                <div id="materie-list" class="materie-list">
                    {% for materia in materie %}
                    <div class="materia-item" data-id="{{ materia.id }}" style="border-left: 4px solid {{ materia.colore }}">
                        <h4 class="materia-name" onclick="toggleMateriaArgomenti({{ materia.id }})">
                            <span class="expand-icon">‚ñ∂</span>
                            {{ materia.nome }}
                        </h4>
                        <div id="argomenti-{{ materia.id }}" class="argomenti-list" style="display: none;">
                            <!-- Gli argomenti verranno caricati dinamicamente -->
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div id="argomenti-list" class="argomenti-list" style="display: none;">
                    <button class="cancel-btn back-btn" onclick="showMaterieList()">‚Üê Torna alle materie</button>
                    <div id="argomenti-grid" class="argomenti-grid">
                        <!-- Gli argomenti verranno caricati dinamicamente -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/collegamenti.js"></script>
</body>
</html>
